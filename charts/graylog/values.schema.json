{
  "$schema": "https://json-schema.org/schema#",
  "title": "Graylog Helm Chart Values Schema",
  "type": "object",
  "required": [],
  "properties": {
    "provider": {
      "type": "string",
      "description": "Kubernetes provider (optional)",
      "oneOf": [
        {
          "type": "string",
          "enum": [ "aws", "aws-managed-sc", "azure", "gcp", "microk8s", "" ]
        },
        { "type": "null" }
      ]
    },
    "version": {
      "type": "string",
      "description": "Override Graylog and Graylog Data Node version (optional)"
    },
    "nameOverride": {
      "type": "string",
      "description": "Override the name of the chart. Affects app.kubernetes.io/name annotation"
    },
    "fullnameOverride": {
      "type": "string",
      "description": "Override the fully qualified app name."
    },
    "global": {
      "type": "object",
      "properties": {
        "imagePullSecrets": {
          "type": "array",
          "items": { "type": "string" }
        },
        "storageClass": { "type": "string" },
        "existingSecretName": { "type": "string", "description": "Name of existing Graylog secret containing GRAYLOG_MONGODB_URI, GRAYLOG_ROOT_USERNAME, GRAYLOG_PASSWORD_SECRET, and GRAYLOG_ROOT_PASSWORD_SHA2" }
      }
    },
    "graylog": {
      "type": "object",
      "description": "Graylog application values",
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "enterprise": { "type": "boolean", "default": true },
        "replicas": { "type": "integer" },
        "service": {
          "type": "object",
          "properties": {
            "nameOverride": { "type": "string" },
            "type": { "type": "string" },
            "ports": {
              "type": "object",
              "properties": {
                "app": { "type": "integer" },
                "metrics": { "type": "integer" }
              }
            },
            "metrics": {
              "type": "object",
              "properties": {
                "enabled": { "type":  "boolean" }
              }
            }
          }
        },
        "inputs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "port": { "type": "integer" },
              "targetPort": { "type": "integer" },
              "protocol": { "type": "string" }
            },
            "required": [ "name", "port", "protocol" ]
          }
        },
        "plugins": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "image": { "type": "string" },
              "existingClaim": { "type": "string" },
              "url": { "type": "string" },
              "checksum": { "type": "string" }
            },
            "required": [ "name" ],
            "oneOf": [
              {
                "required": [ "image" ],
                "not": { "required": [ "existingClaim", "url" ] }
              },
              {
                "required": [ "existingClaim" ],
                "not": { "required": [ "image", "url" ] }
              },
              {
                "required": [ "url" ],
                "not": { "required":  [ "existingClaim", "image" ] }
              }
            ],
            "allOf": [
              {
                "if": { "required": [ "checksum" ] },
                "then": { "required": [ "url" ] }
              }
            ]
          }
        },
        "env": {
          "type": "object",
          "additionalProperties": {
            "type": ["string","number","boolean"]
          },
          "description": "Key/value env vars rendered as literals"
        },
        "config": {
          "type": "object",
          "description": "Graylog server configuration. These values can be found in server.conf",
          "properties": {
            "rootUsername": { "type": "string" },
            "rootPassword": { "type": "string" },
            "customSecretPepper": { "type": "string" },
            "timezone": { "type": "string" },
            "selfSignedStartup": { "type": "string" },
            "serverJavaOpts": { "type": "string" },
            "extraServerJavaOpts": {
              "type": "array",
              "items": { "type": "string" }
            },
            "leaderElectionMode": { "type": "string" },
            "contentPacksAutoInstall": { "type": "string" },
            "isCloud": { "type": "string" },
            "tls": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "secretName": { "type": "string" },
                "keyPassword": { "type": "string" },
                "updateKeyStore": { "type": "boolean" },
                "keyStorePass": { "type": "string" }
              }
            },
            "mongodb": {
              "type": "object",
              "properties": {
                "customUri": { "type": "string" },
                "maxConnections": { "type": "string" },
                "versionProbeAttempts": { "type": "string" }
              }
            },
            "messageJournal": {
              "type": "object",
              "properties": {
                "enabled": { "type": "string" },
                "flushAge": { "type": "string" },
                "flushInterval": { "type": "string" },
                "maxAge": { "type": "string" },
                "segmentAge": { "type": "string" },
                "segmentSize": { "type": "string" }
              }
            },
            "network": {
              "type": "object",
              "properties": {
                "connectTimeout": { "type": "string" },
                "enableCors": { "type": "string" },
                "enableGzip": { "type": "string" },
                "maxHeaderSize": { "type": "string" },
                "readTimeout": { "type": "string" },
                "threadPoolSize": { "type": "string" },
                "externalUri": { "type": "string" }
              }
            },
            "performance": {
              "type": "object",
              "properties": {
                "asyncEventbusProcessors": { "type": "string" },
                "autoRestartInputs": { "type": "string" },
                "inputBufferProcessors": { "type": "string" },
                "inputBufferRingSize": { "type": "string" },
                "inputBufferWaitStrategy": { "type": "string" },
                "jobSchedulerConcurrencyLimits": { "type": "string" },
                "outputBatchSize": { "type": "string" },
                "outputFaultCountThreshold": { "type": "string" },
                "outputFaultPenaltySeconds": { "type": "string" },
                "outputFlushInterval": { "type": "string" },
                "outputBufferProcessorThreadsCorePoolSize": { "type": "string" },
                "outputBufferProcessors": { "type": "string" },
                "processBufferProcessors": { "type": "string" }
              }
            },
            "email": {
              "type": "object",
              "properties": {
                "enabled": { "type": "string" },
                "senderAddress": { "type": "string" },
                "hostname": { "type": "string" },
                "port": { "type": "string" },
                "socketConnectionTimeout": { "type": "string" },
                "socketTimeout": { "type": "string" },
                "useAuth": { "type": "string" },
                "useSsl": { "type": "string" },
                "useTls": { "type": "string" },
                "webInterfaceUrl": { "type": "string" }
              }
            },
            "plugins": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" }
              }
            },
            "geolocation": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "maxmindGeoIp": {
                  "type": "object",
                  "properties": {
                    "enabled": { "type": "boolean" },
                    "accountId": { "type": ["string", "null"] },
                    "licenseKey": { "type": ["string", "null"] },
                    "cronSchedule": { "type": "string" },
                    "postInstallRun": { "type": "boolean" }
                  }
                },
                "mmdbSources": {
                  "type": "object",
                  "properties": {
                    "city": {
                      "type": "object",
                      "properties": {
                        "url": { "type": ["string", "null"] },
                        "checksum": { "type": ["string", "null"] }
                      }
                    },
                    "asn": {
                      "type": "object",
                      "properties": {
                        "url": { "type": ["string", "null"] },
                        "checksum": { "type": ["string", "null"] }
                      }
                    }
                  }
                }
              }
            },
            "init": {
              "type": "object",
              "properties": {
                "assetFetch": {
                  "type": "object",
                  "properties": {
                    "enabled": { "type": "boolean" },
                    "skipChecksum": { "type": "boolean" },
                    "allowHttp": { "type": "boolean" },
                    "plugins": {
                      "type": "object",
                      "properties": {
                        "enabled": { "type": "boolean" },
                        "baseUrl": { "type": ["string", "null"] }
                      }
                    },
                    "geolocation": {
                      "type": "object",
                      "properties": {
                        "enabled": { "type": "boolean" },
                        "baseUrl": { "type": ["string", "null"] }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "image": {
          "type": "object",
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "imagePullPolicy": { "type": "string" },
            "imagePullSecrets": { "type": "array" }
          }
        },
        "updateStrategy": {
          "type": "object",
          "properties": {
            "type": { "type": ["string", "null"] },
            "rollingUpdate": {
              "type": "object",
              "properties": {
                "maxUnavailable": { "type": [ "string", "integer", "null" ] },
                "partition": { "type": [ "string", "null" ] }
              }
            }
          }
        },
        "resources": {
          "type": "object",
          "properties": {
            "limits": {
              "type": "object",
              "properties": {
                "cpu": { "type": "string" },
                "memory": { "type": "string" }
              }
            },
            "requests": {
              "type": "object",
              "properties": {
                "cpu": { "type": "string" },
                "memory": { "type": "string" }
              }
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "storageClass": { "type": [ "string", "null" ] },
            "volumeNameOverride": { "type": [ "string", "null" ] },
            "existingClaim": { "type": [ "string", "null" ] },
            "mountPath": { "type": [ "string", "null" ] },
            "accessModes": { "type": "array" },
            "size": { "type": [ "string", "null" ] },
            "annotations": {
              "type": "object"
            },
            "labels": {
              "type": "object"
            },
            "selector": {
              "type": "object"
            }
          }
        },
        "livenessProbe": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "initialDelaySeconds": { "type": "integer" },
            "periodSeconds": { "type": "integer" },
            "timeoutSeconds": { "type": "integer" },
            "failureThreshold": { "type": "integer" },
            "successThreshold": { "type": "integer" }
          }
        },
        "readinessProbe": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "initialDelaySeconds": { "type": "integer" },
            "periodSeconds": { "type": "integer" },
            "timeoutSeconds": { "type": "integer" },
            "failureThreshold": { "type": "integer" },
            "successThreshold": { "type": "integer" }
          }
        },
        "podDisruptionBudget": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "minAvailable": { "type": "integer" }
          }
        },
        "podAnnotations": {
          "type": "object"
        },
        "nodeSelector": {
          "type": "object"
        },
        "tolerations": {
          "type": "array",
          "items": { "type": "object" }
        },
        "affinity": {
          "type": "object"
        },
        "extraEnv": {
          "type": "array",
          "items": { "type": "object" },
          "description": "Full EnvVar objects (supports valueFrom)"
        }
      }
    },
    "datanode": {
      "type": "object",
      "description": "Graylog Datanode configuration",
      "properties": {
        "enabled": { "type": "boolean" },
        "replicas": { "type": "integer" },
        "service": {
          "type": "object",
          "properties": {
            "ports": {
              "type": "object",
              "properties": {
                "api": { "type": "integer" },
                "data": { "type": "integer" },
                "config": { "type": "integer" }
              }
            }
          }
        },
        "env": {
          "type": "object",
          "additionalProperties": {
            "type": ["string","number","boolean"]
          },
          "description": "Key/value env vars rendered as literals"
        },
        "config": {
          "type": "object",
          "properties": {
            "nodeIdFile": { "type": "string" },
            "opensearchHeap": { "type": "string" },
            "javaOpts": { "type": "string" },
            "skipPreflightChecks": { "type": "string" },
            "nodeSearchCacheSize": { "type": "string" },
            "s3ClientDefaultSecretKey": { "type": "string" },
            "s3ClientDefaultAccessKey": { "type": "string" },
            "s3ClientDefaultEndpoint": { "type": "string" },
            "s3ClientDefaultRegion": { "type": "string" },
            "s3ClientDefaultProtocol": { "type": "string" },
            "s3ClientDefaultPathStyleAccess": { "type": "string" }
          }
        },
        "image": {
          "type": "object",
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "imagePullPolicy": { "type": "string" },
            "imagePullSecrets": { "type": "array" }
          }
        },
        "updateStrategy": {
          "type": "object",
          "properties": {
            "type": { "type": ["string", "null"] },
            "rollingUpdate": {
              "type": "object",
              "properties": {
                "maxUnavailable": { "type": [ "string", "integer", "null" ] },
                "partition": { "type": [ "string", "null" ] }
              }
            }
          }
        },
        "resources": {
          "type": "object",
          "properties": {
            "limits": {
              "type": "object",
              "properties": {
                "cpu": { "type": "string" },
                "memory": { "type": "string" }
              }
            },
            "requests": {
              "type": "object",
              "properties": {
                "cpu": { "type": "string" },
                "memory": { "type": "string" }
              }
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "data": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "storageClass": { "type": "string" },
                "existingClaim": { "type": "string" },
                "mountPath": { "type": "string" },
                "accessModes": { "type": "array" },
                "size": { "type": "string" },
                "annotations": {
                  "type": "object"
                },
                "labels": {
                  "type": "object"
                },
                "selector": {
                  "type": "object"
                },
                "dataSource": {
                  "type": "object"
                }
              }
            },
            "nativeLibs": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "storageClass": { "type": "string" },
                "existingClaim": { "type": "string" },
                "mountPath": { "type": "string" },
                "accessModes": { "type": "array" },
                "size": { "type": "string" },
                "annotations": {
                  "type": "object"
                },
                "labels": {
                  "type": "object"
                },
                "selector": {
                  "type": "object"
                }
              }
            }
          }
        },
        "livenessProbe": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "initialDelaySeconds": { "type": "integer" },
            "periodSeconds": { "type": "integer" },
            "timeoutSeconds": { "type": "integer" },
            "failureThreshold": { "type": "integer" },
            "successThreshold": { "type": "integer" }
          }
        },
        "readinessProbe": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "initialDelaySeconds": { "type": "integer" },
            "periodSeconds": { "type": "integer" },
            "timeoutSeconds": { "type": "integer" },
            "failureThreshold": { "type": "integer" },
            "successThreshold": { "type": "integer" }
          }
        },
        "podDisruptionBudget": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "minAvailable": { "type": "integer" }
          }
        },
        "podAnnotations": {
          "type": "object"
        },
        "nodeSelector": {
          "type": "object"
        },
        "tolerations": {
          "type": "array",
          "items": { "type": "object" }
        },
        "affinity": {
          "type": "object"
        },
        "extraEnv": {
          "type": "array",
          "items": { "type": "object" },
          "description": "Full EnvVar objects (supports valueFrom)"
        }
      }
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "create": { "type": "boolean" },
        "automount": { "type": "boolean" },
        "annotations": { "type": "object" },
        "nameOverride": { "type": "string" },
        "role": {
          "type": "object",
          "properties": {
            "create": { "type": "boolean" },
            "rules": { "type": "array" }
          }
        }
      }
    },
    "ingress": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "config": {
          "type": "object",
          "properties": {
            "defaultBackend": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" }
              }
            },
            "tls": {
              "type": "object",
              "properties": {
                "clusterIssuer": {
                  "type": "object",
                  "properties": {
                    "existingName": { "type": ["string", "null"] }
                  }
                },
                "issuer": {
                  "type": "object",
                  "properties": {
                    "existingName": { "type": ["string", "null"] },
                    "managed": {
                      "type": "object",
                      "properties": {
                        "enabled": { "type": "boolean" },
                        "staging": { "type": "boolean" }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "web": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "className": { "type": "string" },
            "annotations": { "type": "object" },
            "hosts": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "host": { "type": "string" },
                  "paths": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "path": { "type": "string" },
                        "pathType": { "type": "string" }
                      }
                    }
                  }
                }
              }
            },
            "tls": { "type": "array" }
          }
        },
        "forwarder": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "className": { "type": "string" },
            "annotations": { "type": "object" },
            "hosts": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "host": { "type": "string" },
                  "paths": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "path": { "type": "string" },
                        "pathType": { "type": "string" }
                      }
                    }
                  }
                }
              }
            },
            "tls": { "type": "array" }
          }
        }
      }
    },
    "mongodb": {
      "type": "object",
      "description": "MongoDB Community Resource configuration. Requires the MCK Operator.",
      "properties": {
        "communityResource": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" }
          }
        },
        "version": { "type": "string" },
        "replicas": { "type": "integer" },
        "arbiters": { "type": "integer" },
        "persistence": {
          "type": "object",
          "properties": {
            "storageClass": { "type": "string" },
            "size": {
              "type": "object",
              "properties": {
                "data": { "type": "string" },
                "logs": { "type": "string" }
              }
            }
          }
        },
        "serviceAccount": {
          "type": "object",
          "properties": {
            "create": { "type": "boolean" },
            "automount": { "type": "boolean" },
            "annotations": { "type": "object" },
            "nameOverride": { "type": "string" },
            "role": {
              "type": "object",
              "properties": {
                "create": { "type": "boolean" },
                "rules": { "type": "array" }
              }
            }
          }
        }
      }
    }
  }
}
